// Generated by github.com/arran4/go-subcommand/cmd/gosubc

package {{.PackageName}}

import (
	"testing"
)

{{ define "construct_cmd" -}}
{{- if .Parent -}}
{{- template "construct_cmd" .Parent }}.New{{.SubCommandStructName}}()
{{- else -}}
root.New{{.SubCommandStructName}}()
{{- end -}}
{{- end -}}

func Test{{.SubCommandStructName}}_Execute_Computed(t *testing.T) {
	t.Parallel()

	root, err := NewRoot("test", "v1", "commit", "date")
	if err != nil {
		t.Fatal(err)
	}

	cmd := {{ template "construct_cmd" . }}

	called := false
	cmd.CommandAction = func(c *{{.SubCommandStructName}}) error {
		called = true
		return nil
	}

	args := []string{
	{{- range .Parameters }}
		{{- $param := . }}
		{{- if $param.IsPositional }}
			{{- if $param.IsVarArg }}
				{{- range until $param.VarArgMin }}
				{{- if eq $param.Type "int" }}"0",
				{{- else if eq $param.Type "bool" }}"true",
				{{- else if eq $param.Type "time.Duration" }}"0s",
				{{- else }}"test",{{- end }}
				{{- end }}
			{{- else }}
				{{- if eq $param.Type "int" }}"0",
				{{- else if eq $param.Type "bool" }}"true",
				{{- else if eq $param.Type "time.Duration" }}"0s",
				{{- else }}"test",{{- end }}
			{{- end }}
		{{- end }}
	{{- end }}
	}

	if err := cmd.Execute(args); err != nil {
		t.Errorf("Execute() error = %v", err)
	}
	if !called {
		t.Error("CommandAction was not called")
	}
}
