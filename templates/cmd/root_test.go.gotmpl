// Generated by github.com/arran4/go-subcommand/cmd/gosubc

package main

import (
	"testing"
	{{- $hasDuration := false }}
	{{- range .Parameters}}
	{{- if eq .Type "time.Duration" }}
	{{- $hasDuration = true }}
	{{- end }}
	{{- end }}
	{{- if $hasDuration }}
	"time"
	{{- end }}
)

func TestRoot_Execute(t *testing.T) {
	cmd, err := NewRoot("test", "", "", "")
	if err != nil {
		t.Fatalf("Failed to create root command: %v", err)
	}

	{{if .FunctionName}}
	called := false
	cmd.CommandAction = func(c *RootCmd) error {
		called = true
		return nil
	}

	args := []string{}
	{{- range .Parameters}}
	{{- $param := . }}
	{{- if .IsPositional}}
		{{- if .IsVarArg}}
			{{- if gt .VarArgMin 0}}
				{{- range until .VarArgMin}}
					{{- if eq $param.Type "string"}}
					args = append(args, "test")
					{{- else if eq $param.Type "int"}}
					args = append(args, "1")
					{{- else if eq $param.Type "bool"}}
					args = append(args, "true")
					{{- else if eq $param.Type "time.Duration"}}
					args = append(args, "1s")
					{{- end}}
				{{- end}}
			{{- end}}
		{{- else}}
			{{- if eq .Type "string"}}
			args = append(args, "test")
			{{- else if eq .Type "int"}}
			args = append(args, "1")
			{{- else if eq .Type "bool"}}
			args = append(args, "true")
			{{- else if eq .Type "time.Duration"}}
			args = append(args, "1s")
			{{- end}}
		{{- end}}
	{{- end}}
	{{- end}}

	err = cmd.Execute(args)
	if err != nil {
		t.Errorf("Unexpected error: %v", err)
	}
	if !called {
		t.Error("CommandAction was not called")
	}
	{{else}}
	// No function defined for root command, so Execute expects a subcommand.
	// We can test that it fails with unknown command or usage.
	err = cmd.Execute([]string{"unknown-command"})
	if err == nil {
		t.Error("Expected error for unknown command, got nil")
	}
	{{end}}
}
